<div class="container mx-auto mt-10 px-4 py-10">
  <div class="bg-white p-4 rounded-lg shadow-sm mb-6">
    <div class="flex flex-col sm:flex-row justify-between sm:items-center">
      <div>
        <%= link_to "Shift Questions", shift_questions_path, class: "px-4 py-2 bg-gray-100 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-violet-500" %>
      </div>
    </div>
  </div>
  <% if params[:notice].present? %>
    <div class="mb-4 rounded-md bg-green-50 border border-green-200 text-green-800 px-4 py-3">
      <%= params[:notice] %>
    </div>
  <% end %>
  <% if params[:alert].present? %>
    <div class="mb-4 rounded-md bg-red-50 border border-red-200 text-red-800 px-4 py-3">
      <%= params[:alert] %>
    </div>
  <% end %>
  <% if @connection %>
    <div class="bg-green-100 p-4 rounded-3xl mb-6">
      <div class="text-lg font-semibold text-green-700 mb-2">Active scopes & tenant</div>
      <div class="text-green-700">
        <% tenant_display = (@connection.respond_to?(:tenant_name) && @connection.tenant_name.present?) ? @connection.tenant_name : 'â€”' %>
        Tenant: <%= tenant_display %> (<%= @connection.tenant_id %>)
      </div>
      <div class="text-green-700 mt-1">
        Stored scopes: <%= @connection.scopes %>
      </div>
      <p class="text-xs text-gray-500 mt-2">
        Scopes are granted by Xero during connection. Reconnecting your account will update them.
      </p>
    </div>
  <% end %>
  <h1 class="text-3xl font-bold mb-6">Xero Integration</h1>

  <div class="mb-4">
    <%= link_to "Reconnect Xero with required scopes", new_admin_xero_connection_path, class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-3xl" , data: { turbo: false } %>
    <p class="text-sm text-gray-600 mt-1">Scopes: offline_access accounting.settings.read payroll.employees payroll.employees.read payroll.settings</p>
  </div>

  <% if @connection %>
    <div class="bg-white p-6 rounded-3xl">
      <p class="text-lg font-semibold text-green-600">Payroll Set up</p>
      <p class="mt-2 text-gray-700">Get employees from Xero then link them. Get pay rate items from Xero then link them.</p>
      <div class="mt-4 flex flex-wrap gap-4">
        <%= button_to "Sync Employees", admin_xero_connection_path, params: { sync: 'employees' }, method: :patch, class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-3xl" %>
        <%= button_to "Link Employees", edit_user_mappings_admin_xero_connection_path, method: :get, class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-3xl" %>
        <%= button_to "Sync Pay Rates", admin_xero_connection_path, params: { sync: 'pay_items' }, method: :patch, class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-3xl" %>
        <%= button_to "Link Pay Rates", admin_shift_types_path, method: :get, class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-3xl" %>
      </div>
    </div>
    <div class="bg-white p-6 rounded-3xl mt-6">
      <p class="text-lg font-semibold text-green-600">Invoice Set up</p>
      <p class="mt-2 text-gray-700">Get invoice line items from Xero then link them with each clients shift area.</p>
      <div class="mt-4 flex flex-wrap gap-4">
        <%= button_to "Sync Invoice Items", sync_admin_xero_items_path, method: :post, class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-3xl" %>
        <%= link_to "Area Mapping", admin_xero_item_mappings_path, class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-3xl" %>
      </div>
    </div>
    <div class="bg-white p-6 rounded-3xl mt-6">
      <p class="text-lg font-semibold text-green-600">Connected to Xero</p>
      <p class="mt-2 text-gray-700">Tenant ID: <%= @connection.tenant_id %></p>
      <div class="mt-4 flex flex-wrap gap-4">
        <%= button_to "Disconnect from Xero", admin_xero_connection_path, method: :delete, data: { confirm: "Are you sure?" }, class: "bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-3xl" %>
      </div>
    </div>
  <% else %>
    <div class="bg-white p-6 rounded-lg shadow-md">
      <p class="text-lg font-semibold text-gray-700">Not connected to Xero</p>
      <p class="mt-2 text-gray-600">Connect your Xero account to enable payroll and invoice exports.</p>
      <div class="mt-4">
        <%= link_to "Connect to Xero", new_admin_xero_connection_path, class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-3xl" %>
      </div>
    </div>
  <% end %>
</div>