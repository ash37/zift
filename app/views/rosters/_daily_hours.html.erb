<%
  # Prefer precomputed totals when available (set in controller)
  if defined?(@hours_by_date) && @hours_by_date
    total_hours = @hours_by_date[date] || 0
  else
    # Fallback: compute from DB (respect selected_location_id if provided)
    shifts_for_day = roster.shifts.where(start_time: date.all_day)
    if defined?(selected_location_id) && selected_location_id.present?
      shifts_for_day = shifts_for_day.where(location_id: selected_location_id)
    end
    total_seconds = shifts_for_day.sum { |shift| shift.end_time - shift.start_time }
    total_hours = total_seconds / 3600.0
  end
%>

<%# This div has a unique ID so we can target it with a Turbo Stream. %>
<div id="<%= dom_id(roster, "daily_hours_#{date.to_s}") %>" class="text-sm font-semibold text-zinc-800">
  <%= number_with_precision(total_hours, precision: 2) %>h
</div>
