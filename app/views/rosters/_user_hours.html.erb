<%# This partial calculates and displays the total weekly hours for a given user and roster. %>
<%
  # Define the start and end dates for the visible week.
  week_start = roster.starts_on.beginning_of_day
  week_end = roster.starts_on.end_of_day + 6.days

  # This is the corrected query. It now scopes the shifts to the specific
  # 7-day period of the roster being displayed.
  user_shifts_for_week = roster.shifts.where(user: user, start_time: week_start..week_end).where(unscheduled: false)
  
  # Calculate the total duration in seconds.
  total_seconds = user_shifts_for_week.sum { |shift| shift.end_time - shift.start_time }
  # Convert seconds to hours.
  total_hours = total_seconds / 3600.0
%>

<div class="text-xs text-zinc-500 font-normal mt-1 ml-1 xl:ml-4">
  <%= number_with_precision(total_hours, precision: 2) %> hrs
</div>
